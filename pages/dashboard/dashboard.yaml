id: dashboard
type: PageHeaderMenu
properties:
  title: Dashboard

layout:
  contentGutter: 10

events:
  onMount:
    - id: init
      type: SetState
      params:
        # Set everything to loading
        revenue_cards_loading: true
        revenue_charts_loading: true
        user_cards_loading: true
        user_charts_loading: true
        default_start_date:
          _date: 2024-02-20 #TODO: Make week before current
        default_end_date:
          _date: now

  onMountAsync:
    - id: fetch_order_completions
      type: Request
      params:
        - fetch_orders_completed
    - id: fetch_service_completions
      type: Request
      params:
        - fetch_services_completed

    - id: set_fetched_orders_completed
      type: SetState
      params:
        result_orders_completed:
          _if_none:
            - _request: fetch_orders_completed.1.order_price #TODO: make this the amount
            - -1
    - id: set_fetched_services_completed
      type: SetState
      params:
        result_services_completed:
          _if_none:
            - _request: fetch_services_completed.0.order_price #TODO: make this the amount
            - -1

requests:
  - _ref: pages/dashboard/components/cards/requests/fetch_cancellations.yaml
  - _ref: pages/dashboard/components/cards/requests/fetch_deliveries.yaml
  - _ref: pages/dashboard/components/cards/requests/fetch_orders_completed.yaml
  - _ref: pages/dashboard/components/cards/requests/fetch_services_completed.yaml

areas:
  content:
    justify: center
    blocks:
      - id: section_income
        type: Title 
        properties:
          content: Revenue Data
          level: 3
      - id: date_range_container
        type: Box
        layout:
          span: 16
          contentGutter: 10
        blocks:
          - id: revenue_date_range
            type: DateRangeSelector
            layout:
              span: 20
            properties:
              placeholder:
                - Start Date
                - End Date
              title: "Revenue Date Range"
              disabledDates:
                max: 
                  _date: now
          - id: refresh_btn
            type: Button
            layout:
              span: 4
              align: bottom
            properties:
              title: Refresh
              style:
                background: "#ffffff"
                borderColor: "#ffffff"
                color: "#000000"
            events:
              onClick:
                - id: set_saved_title
                  type: SetState
                  params:
                    saved_title:
                      _state: 
                        key: default_start_date
                        default: "Changed with button"
      
      - id: revenue_data_container
        type: Box
        layout:
          span: 24
          contentGutter: 16
        blocks:
          - _ref: pages/dashboard/components/charts/revenue_chart.yaml
          - _ref: pages/dashboard/components/charts/revenue_pie.yaml
          
          - _ref: pages/dashboard/components/cards/orders_completed.yaml
          - _ref: pages/dashboard/components/cards/services_completed.yaml
          - _ref: pages/dashboard/components/cards/cancellations.yaml
          - _ref: pages/dashboard/components/cards/deliveries.yaml

      - id: section_divider
        type: Divider

      - id: test_title
        type: Title
        visible: 
          _state: title_visible
        properties:
          content: 
            _state: 
              key: saved_title
              default: 
                _state: default_end_date
          level: 3

      # - id: section_users
      #   type: Title
      #   properties:
      #     content: User Data
      #     level: 3

      # - id: date_range_container
      #   type: Box
      #   layout:
      #     span: 12
      #     align: center
      #     offset: 6
      #   blocks:
      #     - id: users_date_range
      #       type: DateRangeSelector
      #       properties:
      #         placeholder:
      #           - Start Date
      #           - End Date
      #         title: "User Activity Date Range"
      #         # title:
      #         disabledDates:
      #           max: 
      #             _state: 
      #               key: start_date_revenue
      #               default: 
      #                 _date: now
      #       # events:
      #       #   properties:
      #       #     onChange:
      #       #       - id: set_user_dates
      #       #         type: SetState
      #       #         params:
      #       #           start_date_users: #TODO use input date
      #       #           end_date_users: #TODO use input date
        
      # - _ref: pages/dashboard/components/charts/active_user_chart.yaml

      # - id: user_activity_data
      #   type: Box
      #   layout: 
      #     span: 8
      #     contentGutter: 10
      #   blocks:
      #     - _ref: pages/dashboard/components/cards/account_creations.yaml